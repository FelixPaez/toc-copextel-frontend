<div class="password-update-dialog">
  <h2 mat-dialog-title class="dialog-title">Actualizar contraseña</h2>
  
  <mat-dialog-content class="dialog-content">
    <div class="user-info">
      <div class="user-avatar">
        <span class="avatar-initials">{{ getUserInitials() }}</span>
      </div>
      
      <div class="user-details">
        <div class="user-name">{{ getUserDisplayName() }}</div>
        <div class="email-info">
          <mat-icon class="email-icon">email</mat-icon>
          <span class="email-text">{{ data.user.email }}</span>
        </div>
      </div>
    </div>

    <form [formGroup]="passwordForm" class="password-form">
      <!-- Contraseña -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Contraseña *</mat-label>
        <input 
          matInput 
          [type]="hidePassword ? 'password' : 'text'"
          formControlName="password" 
          placeholder="Ingresa la nueva contraseña">
        <button 
          mat-icon-button 
          matSuffix 
          type="button"
          (click)="togglePasswordVisibility()"
          [attr.aria-label]="'Ocultar contraseña'"
          [attr.aria-pressed]="hidePassword">
          <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        @if (passwordForm.get('password')?.hasError('required') && passwordForm.get('password')?.touched) {
          <mat-error>La contraseña es requerida</mat-error>
        }
        @if (passwordForm.get('password')?.hasError('minlength') && passwordForm.get('password')?.touched) {
          <mat-error>La contraseña debe tener al menos 6 caracteres</mat-error>
        }
      </mat-form-field>

      <!-- Confirmar Contraseña -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Confirmar contraseña *</mat-label>
        <input 
          matInput 
          [type]="hideConfirmPassword ? 'password' : 'text'"
          formControlName="confirmPassword" 
          placeholder="Confirma la nueva contraseña">
        <button 
          mat-icon-button 
          matSuffix 
          type="button"
          (click)="toggleConfirmPasswordVisibility()"
          [attr.aria-label]="'Ocultar contraseña'"
          [attr.aria-pressed]="hideConfirmPassword">
          <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        @if (passwordForm.get('confirmPassword')?.hasError('required') && passwordForm.get('confirmPassword')?.touched) {
          <mat-error>La confirmación de contraseña es requerida</mat-error>
        }
        @if (passwordForm.get('confirmPassword')?.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched) {
          <mat-error>Las contraseñas no coinciden</mat-error>
        }
      </mat-form-field>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions class="dialog-actions">
    <button mat-stroked-button (click)="onCancel()">
      Cancelar
    </button>
    <button 
      mat-raised-button 
      color="primary"
      [disabled]="passwordForm.invalid"
      (click)="onSubmit()">
      Actualizar contraseña
    </button>
  </mat-dialog-actions>
</div>
