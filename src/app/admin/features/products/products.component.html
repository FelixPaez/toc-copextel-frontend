<div class="products-container">
  <!-- Header -->
  <div class="page-header admin-card animate-fade-in">
    <div class="page-left">
      <div class="breadcrumbs">
        <span class="crumb">Tienda</span>
        <mat-icon class="crumb-sep">chevron_right</mat-icon>
        <span class="crumb current">Productos</span>
      </div>
      <h1 class="page-title">Productos</h1>
    </div>
    <div class="page-right">
      <div class="search-section">
        <mat-icon class="search-icon">search</mat-icon>
        <input type="text" placeholder="Buscar productos..." class="search-input">
      </div>
      <button mat-raised-button class="btn-danger" routerLink="new">
        <mat-icon>add</mat-icon>
        Nuevo
      </button>
    </div>
  </div>

  <!-- Tabla de Productos -->
  <mat-card class="products-table-card admin-card animate-fade-in hover-raise">
    <mat-card-content>
      <div class="table-header">
        <div class="table-right">
          <h3 class="table-title">Listado de productos en almacén</h3>
          <button mat-icon-button class="table-actions" [matMenuTriggerFor]="tableMenu"><mat-icon>more_vert</mat-icon></button>
        </div>
        <mat-menu #tableMenu="matMenu">
          <button mat-menu-item><mat-icon>download</mat-icon><span>Exportar</span></button>
          <button mat-menu-item><mat-icon>print</mat-icon><span>Imprimir</span></button>
        </mat-menu>
      </div>
      <table mat-table [dataSource]="products" class="products-table admin-table">
        
        <!-- Código Column -->
        <ng-container matColumnDef="code">
          <th mat-header-cell *matHeaderCellDef>Código</th>
          <td mat-cell *matCellDef="let product">{{product.code}}</td>
        </ng-container>

        <!-- Nombre Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Producto</th>
          <td mat-cell *matCellDef="let product">
            <span class="product-name">{{product.name}}</span>
          </td>
        </ng-container>

        <!-- Precio CUP Estatal -->
        <ng-container matColumnDef="priceCupState">
          <th mat-header-cell *matHeaderCellDef>Precio CUP<br>Sector Estatal</th>
          <td mat-cell *matCellDef="let product">{{product.priceCupState}}</td>
        </ng-container>

        <!-- Precio MLC Estatal -->
        <ng-container matColumnDef="priceMlcState">
          <th mat-header-cell *matHeaderCellDef>Precio MLC<br>Sector Estatal</th>
          <td mat-cell *matCellDef="let product">{{product.priceMlcState}}</td>
        </ng-container>

        <!-- Precio CUP No Estatal -->
        <ng-container matColumnDef="priceCupNonState">
          <th mat-header-cell *matHeaderCellDef>Precio CUP<br>Sector no Estatal</th>
          <td mat-cell *matCellDef="let product">{{product.priceCupNonState}}</td>
        </ng-container>

        <!-- Precio MLC No Estatal -->
        <ng-container matColumnDef="priceMlcNonState">
          <th mat-header-cell *matHeaderCellDef>Precio MLC<br>Sector no Estatal</th>
          <td mat-cell *matCellDef="let product">{{product.priceMlcNonState}}</td>
        </ng-container>

        <!-- Stock Column -->
        <ng-container matColumnDef="stock">
          <th mat-header-cell *matHeaderCellDef>Stock</th>
          <td mat-cell *matCellDef="let product">
            <div class="stock-cell">
              <span class="stock-value" [class.low-stock]="product.stock < 10">{{product.stock}}</span>
              <div class="stock-bar"><span class="bar" [style.width.%]="product.stockPercent"></span></div>
            </div>
          </td>
        </ng-container>

        <!-- Oferta Column -->
        <ng-container matColumnDef="offer">
          <th mat-header-cell *matHeaderCellDef>Oferta</th>
          <td mat-cell *matCellDef="let product">
            @if (product.offer) { <mat-icon class="icon-ok">check</mat-icon> }
          </td>
        </ng-container>

        <!-- Activo Column -->
        <ng-container matColumnDef="active">
          <th mat-header-cell *matHeaderCellDef>Activo</th>
          <td mat-cell *matCellDef="let product">
            @if (product.active) { <mat-icon class="icon-ok">check</mat-icon> }
          </td>
        </ng-container>

        <!-- Acciones Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let product" class="actions-cell">
            <button mat-icon-button class="action-btn" aria-label="Imagen"><mat-icon>photo_camera</mat-icon></button>
            <button mat-icon-button class="action-btn" aria-label="Ver" (click)="onView(product)"><mat-icon>visibility</mat-icon></button>
            <button mat-icon-button class="action-btn" aria-label="Editar" (click)="onEdit(product)"><mat-icon>edit</mat-icon></button>
            <button mat-icon-button class="action-btn warn" aria-label="Eliminar" (click)="onDelete(product)"><mat-icon>delete</mat-icon></button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <!-- Paginación -->
      <mat-paginator 
        [pageSizeOptions]="[5, 10, 25, 50]"
        showFirstLastButtons
        aria-label="Seleccionar página de productos">
      </mat-paginator>
    </mat-card-content>
  </mat-card>
</div>
