<div>
  <div class="d-flex ps-3 ps-3 pt-2 pb-2 o-hidden box-shadow-1 chat-topbar">
    <a appSidebarToggler="chat-sidebar" class="link-icon d-md-none">
      <i class="icon-regular i-Right ms-0 me-3"></i>
    </a>
    @if (activeContact?.id) {
      <div class="d-flex align-items-center">
        <img [src]="activeContact?.avatar" [alt]="activeContact?.name" class="avatar-sm rounded-circle me-2">
        <p class="m-0 text-title text-16 flex-grow-1">{{activeContact?.name}}</p>
      </div>
    }
  </div>

  <ng-scrollbar class="chat-content">
    @if (!chatService.loadingCollection && chatCollection) {
      <div class="">
        @for (chat of chatCollection?.chats; track chat) {
          <div class="mb-4">
            @if (chat.contactId !== activeContact.id) {
              <div class="d-flex user">
                <img [src]="user?.avatar" [alt]="user?.name" class="avatar-sm rounded-circle me-3">
                <div class="message flex-grow-1">
                  <div class="d-flex">
                    <p class="mb-1 text-title text-16 flex-grow-1">{{user?.name}}</p>
                    <span class="text-small text-muted">{{chat.time | date}}</span>
                  </div>
                  <p class="m-0">{{chat.text}}</p>
                </div>
              </div>
            }
            @if (chat.contactId === activeContact.id) {
              <div class="d-flex">
                <div class="message flex-grow-1">
                  <div class="d-flex">
                    <p class="mb-1 text-title text-16 flex-grow-1">{{activeContact?.name}}</p>
                    <span class="text-small text-muted">{{chat.time | date}}</span>
                  </div>
                  <p class="m-0">{{chat.text}}</p>
                </div>
                <img [src]="activeContact?.avatar" [alt]="activeContact?.name" class="avatar-sm rounded-circle ms-3">
              </div>
            }
          </div>
        }
      </div>
    }
  </ng-scrollbar>

  @if (chatCollection && !chatService.loadingCollection) {
    <div class="ps-3 pe-3 pt-3 pb-3 box-shadow-1 chat-input-area"
      >
      <form #msgForm="ngForm" class="inputForm" (ngSubmit)="sendMessage($event)" (keyup.enter)="sendMessage($event)">
        <div class="form-group">
          <textarea class="form-control form-control-rounded" #msgInput ngModel placeholder="Type your message"
          name="message" id="message" cols="30" rows="3"></textarea>
        </div>
        <div class="d-flex">
          <div class="flex-grow-1"></div>
          <button class="btn btn-icon btn-rounded btn-primary me-2">
            <i class="i-Paper-Plane"></i>
          </button>
          <button class="btn btn-icon btn-rounded btn-outline-primary" type="button">
            <i class="i-Add-File"></i>
          </button>
        </div>
      </form>
    </div>
  }

  @if (chatService.loadingCollection) {
    <div class="spinner-glow spinner-glow-warning"></div>
  }

  @if (!chatCollection && !chatService.loadingCollection) {
    <div class="app-inro-circle">
      <div class="border rounded-circle big-bubble"
        [@animate]="{value:'*',params:{scale:'.2',delay:'400ms', duration: '400ms'}}">
        <i class="i-Speach-Bubbles"></i>
      </div>
      <p class="text-16" [@animate]="{value:'*',params:{y:'120px',delay:'600ms', duration: '400ms'}}">Select a contact and
      start chat.</p>
    </div>
  }

</div>